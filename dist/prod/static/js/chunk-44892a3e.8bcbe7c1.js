(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-44892a3e"],{"0152":function(e,t,l){"use strict";var r=l("5964"),o=l.n(r);o.a},3938:function(e,t,l){"use strict";l.r(t);var r=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"main"},[l("div",{staticClass:"bg-white mb24 pd24"},[l("el-form",{attrs:{model:e.roleSearchOption,"label-width":"120px"}},[l("el-row",[l("el-col",{attrs:{span:8}},[l("el-form-item",{attrs:{label:"角色编号",prop:"roleCode"}},[l("el-input",{staticClass:"input-edit-role",attrs:{placeholder:"请输入所属编号"},model:{value:e.roleSearchOption.roleCode,callback:function(t){e.$set(e.roleSearchOption,"roleCode",t)},expression:"roleSearchOption.roleCode"}})],1)],1),l("el-col",{attrs:{span:8}},[l("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[l("el-input",{staticClass:"input-edit-role",model:{value:e.roleSearchOption.roleName,callback:function(t){e.$set(e.roleSearchOption,"roleName",t)},expression:"roleSearchOption.roleName"}})],1)],1),l("el-col",{attrs:{span:8}},[l("el-form-item",{attrs:{label:"角色类型",prop:"roleType"}},[l("el-select",{staticClass:"input-edit-role",attrs:{"value-key":"value",placeholder:"请选择"},model:{value:e.roleSearchOption.roleType,callback:function(t){e.$set(e.roleSearchOption,"roleType",t)},expression:"roleSearchOption.roleType"}},e._l(e.roleTypes,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),l("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.getRoles(1)}}},[e._v("查 询")])],1)],1)],1)],1)],1),l("div",{staticClass:"bg-white user-form-table pd24"},[l("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.goAdd}},[e._v("新增角色")]),l("el-table",{ref:"roleTables",staticClass:"mt10 md20",staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:"","highlight-current-row":"","header-cell-style":{background:"#f3f3f3"},size:"small"}},[l("el-table-column",{attrs:{type:"index",label:"序号"}}),l("el-table-column",{attrs:{type:"selection",width:"55"}}),l("el-table-column",{attrs:{prop:"roleCode",label:"角色编号","min-width":"15%"}}),l("el-table-column",{attrs:{prop:"roleName",label:"角色名称","min-width":"25%"}}),l("el-table-column",{attrs:{prop:"roleType",label:"角色类型","min-width":"10%"}}),l("el-table-column",{attrs:{prop:"service",label:"系统来源","min-width":"10%"}}),l("el-table-column",{attrs:{label:"操作",align:"center",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("DtMenuChoose",{attrs:{role:t.row}}),l("el-button",{attrs:{size:"small",type:"text"},on:{click:function(l){return e.goEdit(t.row)}}},[e._v("编辑")]),l("el-button",{attrs:{size:"small",type:"text"},on:{click:function(l){return e.goDelete(t.row)}}},[e._v("删除")])]}}])})],1),l("common-pagination",{attrs:{list:e.roleSearchOption},on:{"handler-currentPage":e.getRoles}})],1),l("el-dialog",{attrs:{title:"角色编辑",visible:e.dlgRoleVisiable,width:"600px"},on:{"update:visible":function(t){e.dlgRoleVisiable=t}}},[l("el-form",{attrs:{model:e.role,"label-width":"120px",rules:e.roleRules}},[l("el-form-item",{attrs:{label:"角色编号",prop:"roleCode"}},[l("el-input",{model:{value:e.role.roleCode,callback:function(t){e.$set(e.role,"roleCode",t)},expression:"role.roleCode"}})],1),l("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[l("el-input",{model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),l("el-form-item",{attrs:{label:"角色类型",prop:"roleType"}},[l("el-select",{attrs:{placeholder:"请选择"},model:{value:e.role.roleType,callback:function(t){e.$set(e.role,"roleType",t)},expression:"role.roleType"}},e._l(e.roleTypes,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),l("el-form-item",{attrs:{label:"所属系统",prop:"service"}},[l("el-select",{attrs:{"value-key":"code",placeholder:"请选择"},model:{value:e.role.service,callback:function(t){e.$set(e.role,"service",t)},expression:"role.service"}},e._l(e.systems,function(e){return l("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1),l("el-form-item",{attrs:{label:"排序"}},[l("el-input",{attrs:{type:"number"},model:{value:e.role.roleSort,callback:function(t){e.$set(e.role,"roleSort",t)},expression:"role.roleSort"}})],1),l("el-form-item",{attrs:{label:"备注"}},[l("el-input",{model:{value:e.role.remark,callback:function(t){e.$set(e.role,"remark",t)},expression:"role.remark"}})],1)],1),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dlgRoleVisiable=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.saveRole}},[e._v("确 定")])],1)],1)],1)},o=[],a=l("448a"),s=l.n(a),i=l("3156"),n=l.n(i),c=l("9523"),u=l.n(c),p=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"div-root"},[l("el-button",{staticStyle:{margin:"0 5px"},attrs:{size:"mini",type:"text"},on:{click:e.init}},[e._v("分配权限")]),l("el-dialog",{attrs:{title:"权限编辑",visible:e.digMenuVisible},on:{"update:visible":function(t){e.digMenuVisible=t}}},[l("div",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticClass:"div-tree"},[l("el-tree",{ref:"menuTree",attrs:{data:e.menus,"show-checkbox":"","node-key":"resourceId",props:e.menuProps}})],1),l("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.digMenuVisible=!1}}},[e._v("取 消")]),l("el-button",{attrs:{type:"primary"},on:{click:e.saveRoleResource}},[e._v("确 定")])],1)])],1)},d=[],h=l("b775"),m={data:function(){return{LOGIN_URL:"https://ylht.yili.com/api/isump",treeLoading:!1,digMenuVisible:!1,menus:[],menuProps:{children:"children",label:"resourceName"},systemArr:[]}},props:["role"],methods:{getMenu:function(e,t){var l=this;this.treeLoading=!0,h["a"].post("/isump/resource/list/conditions",{sysCode:e},{baseURL:this.LOGIN_URL}).then(function(e){var r=e.data,o=[],a=0,s=!0,i=!1,n=void 0;try{for(var c,u=r[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var p=c.value;"system"!=p.resourceType&&"root"!=p.resourceType||l.systemArr.push(p.resourceId),0==p.levels&&o.push(p),p.levels>a&&(a=p.levels)}}catch(w){i=!0,n=w}finally{try{s||null==u.return||u.return()}finally{if(i)throw n}}for(var d=1;d<=a;d++){if(0!=o.length)break;var h=!0,m=!1,f=void 0;try{for(var b,v=r[Symbol.iterator]();!(h=(b=v.next()).done);h=!0){var g=b.value;g.levels==d&&o.push(g)}}catch(w){m=!0,f=w}finally{try{h||null==v.return||v.return()}finally{if(m)throw f}}}for(var y=0,R=o;y<R.length;y++){var k=R[y];k.children=l.getChildren(k.resourceId,r)}l.menus=o,l.treeLoading=!1,t&&t()})},getChildren:function(e,t){var l=this,r=[];return t=t||[],t.forEach(function(o){var a=n()({},o);a.parentId==e&&(a.children=l.getChildren(a.resourceId,t),r.push(a))}),r},getPermissions:function(){var e=this;h["a"].post("/isump/role-resource/list/conditions",{roleId:this.role.roleId},{baseURL:this.LOGIN_URL}).then(function(t){var l=t.data;e.$refs.menuTree.setCheckedKeys(l.map(function(t){var l=e.$refs.menuTree.getNode(t.resourceId);return l&&l.childNodes&&l.childNodes.length>0?null:t.resourceId}))})},saveRoleResource:function(){for(var e=this,t=this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys()),l=[],r=0;r<t.length;r++){var o=t[r];this.systemArr.indexOf(o)>-1||l.push(o)}h["a"].post("/isump/role-resource/setRoleResources",{resourceIdList:l,roleId:this.role.roleId},{baseURL:this.LOGIN_URL}).then(function(t){t&&"000000"===t.code&&(e.$message({message:"修改权限成功",type:"success"}),e.digMenuVisible=!1)})},init:function(){var e=this;this.digMenuVisible=!this.digMenuVisible,this.getMenu(this.role.service,function(){e.getPermissions()})}},mounted:function(){},created:function(){}},f=m,b=(l("0152"),l("0c7c")),v=Object(b["a"])(f,p,d,!1,null,"e99bf064",null),g=v.exports,y=l("2f62"),R={components:{DtMenuChoose:g},data:function(){var e;return e={LOGIN_URL:"https://ylht.yili.com/api/isump",show:!1,roleSearchOption:{currentPage:1,total:0,pageSize:10},rolesData:[],roleTypes:[{value:"function",label:"function"},{value:"data",label:"data"},{value:"approval",label:"approval"}],dlgRoleVisiable:!1},u()(e,"roleTypes",[{value:"data",lable:"data"},{value:"function",lable:"function"},{value:"approval",lable:"approval"}]),u()(e,"systems",[{code:"contract",name:"合同系统"}]),u()(e,"role",{service:"contract"}),u()(e,"roleRules",{roleCode:[{required:!0,message:"请输入角色编号",trigger:["change","blur"]}],roleName:[{required:!0,message:"请输入角色名称",trigger:["change","blur"]}],roleType:[{required:!0,message:"请选择角色类型",trigger:["change","blur"]}],service:[{required:!0,message:"请输入所属系统",trigger:["change","blur"]}]}),e},computed:n()({},Object(y["b"])(["getAuthObj"])),created:function(){this.getRoles(1)},methods:{goAdd:function(){this.role={},this.dlgRoleVisiable=!0},goEdit:function(e){if(!e)return this.$message({type:"warning",message:"请选择数据后在执行操作"});this.role=e,this.dlgRoleVisiable=!0},saveRole:function(){var e=this,t=this.role;this.role.roleId?h["a"].patch("/isump/role/".concat(this.role.roleId),t,{baseURL:this.LOGIN_URL}).then(function(t){t&&"000000"===t.code&&(e.$message({message:"修改角色成功",type:"success"}),e.getRoles(1),e.dlgRoleVisiable=!1)}):h["a"].post("/isump/role",t,{baseURL:this.LOGIN_URL}).then(function(t){t&&"000000"===t.code&&(e.$message({message:"添加角色成功",type:"success"}),e.getRoles(1),e.dlgRoleVisiable=!1)})},goDelete:function(e){var t=this;this.$confirm("此操作将永久删除该角色信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"稍等，我在想一下",type:"warning"}).then(function(){h["a"].delete("/isump/role/".concat(e.roleId),{baseURL:t.LOGIN_URL}).then(function(e){e&&"000000"===e.code&&(t.$message({message:"删除角色成功",type:"success"}),t.getRoles(1))})}).catch(function(){})},getRoles:function(e){var t=this;this.roleSearchOption.currentPage=e.currentPage||e,h["a"].post("/isump/role/page/conditions",this.roleSearchOption,{baseURL:this.LOGIN_URL}).then(function(e){var l=e.data;t.roleSearchOption.total=l.total,t.roleSearchOption.currentPage=l.current,t.roleSearchOption.pageSize=l.size,t.rolesData=s()(l.records)})}}},k=R,w=Object(b["a"])(k,r,o,!1,null,null,null);t["default"]=w.exports},5964:function(e,t,l){var r=l("5bc5");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=l("499e").default;o("a8d9c624",r,!0,{sourceMap:!1,shadowMode:!1})},"5bc5":function(e,t,l){t=e.exports=l("c356")(!1),t.push([e.i,".div-root[data-v-e99bf064]{display:inline}.div-tree[data-v-e99bf064]{height:400px;overflow-y:auto}",""])}}]);